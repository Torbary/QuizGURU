-- script that prepares a MySQL server

-- CREATE A DATABASE.
CREATE DATABASE IF NOT EXISTS quizguru_db;

-- CREATE A NEW USER.
CREATE USER IF NOT EXISTS 'quizguru_dev'@'localhost' IDENTIFIED BY 'quizguru_dev_pwd';

-- GRANT ALL PRIVILEGES.
GRANT ALL PRIVILEGES ON quizguru_db.* TO 'quizguru_dev'@'localhost';

-- GRANT ALL PRIVILEGES ON PERFORMANCE_SCHEMA
GRANT SELECT ON performance_schema.* TO 'quizguru_db'@'localhost';

-- Table for user

CREATE TABLE IF NOT EXISTS `User` (
  `user_id` SERIAL PRIMARY KEY,
  `email` VARCHAR(255) NOT NULL,
  `firstname` VARCHAR(255) NOT NULL,
  `lastname` VARCHAR(255) NOT NULL,
  `password` VARCHAR(255) NOT NULL,
  `role` varchar(255) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Create Quiz table
CREATE TABLE IF NOT EXISTS `Quiz` (
  `quiz_id` SERIAL PRIMARY KEY,
  `description` TEXT,
  `title` VARCHAR(255) NOT NULL,
  `user_id` INT NOT NULL REFERENCES User(user_id),
  `created at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `question`  VARCHAR(255) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Create table for Questions

CREATE TABLE IF NOT EXISTS `Question` (
  `question_id` SERIAL PRIMARY KEY,
  `title` varchar(255) NOT NULL,
  `answer` varchar(255) NOT NULL,
  `score` int(11) NOT NULL,
  `hint` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


-- Create Option table
CREATE TABLE IF NOT EXISTS Option (
  option_id SERIAL PRIMARY KEY,
  question_id INT NOT NULL REFERENCES Question(question_id),
  option_text TEXT NOT NULL,
  is_correct VARCHAR(1) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

